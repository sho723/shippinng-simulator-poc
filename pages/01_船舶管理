import streamlit as st
import pandas as pd
from src import ShipManager, generate_sample_data, validate_data

st.set_page_config(page_title="èˆ¹èˆ¶ç™»éŒ²", page_icon="ğŸš¢")

st.title("ğŸš¢ èˆ¹èˆ¶ç™»éŒ²")

# ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆæœŸåŒ–
if 'ship_manager' not in st.session_state:
    st.session_state.ship_manager = ShipManager()

ship_manager = st.session_state.ship_manager

# ã‚µã‚¤ãƒ‰ãƒãƒ¼
st.sidebar.header("æ“ä½œãƒ¡ãƒ‹ãƒ¥ãƒ¼")
operation = st.sidebar.selectbox(
    "æ“ä½œã‚’é¸æŠ",
    ["èˆ¹èˆ¶ä¸€è¦§è¡¨ç¤º", "æ–°è¦èˆ¹èˆ¶ç™»éŒ²", "CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ", "CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ", "ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­è¾¼"]
)

if operation == "èˆ¹èˆ¶ä¸€è¦§è¡¨ç¤º":
    st.header("ç™»éŒ²æ¸ˆã¿èˆ¹èˆ¶ä¸€è¦§")
    
    ships = ship_manager.get_all_ships()
    if ships:
        df = ship_manager.to_dataframe()
        st.dataframe(df, use_container_width=True)
        
        # çµ±è¨ˆæƒ…å ±
        col1, col2, col3, col4 = st.columns(4)
        with col1:
            st.metric("ç·èˆ¹èˆ¶æ•°", len(ships))
        with col2:
            st.metric("ç·å®¹é‡", f"{df['capacity'].sum():,.0f} TEU")
        with col3:
            st.metric("å¹³å‡é€Ÿåº¦", f"{df['speed'].mean():.1f} knots")
        with col4:
            st.metric("å¹³å‡ç‡ƒè²»", f"{df['fuel_consumption'].mean():.1f} L/h")
    else:
        st.info("ç™»éŒ²ã•ã‚ŒãŸèˆ¹èˆ¶ãŒã‚ã‚Šã¾ã›ã‚“ã€‚")

elif operation == "æ–°è¦èˆ¹èˆ¶ç™»éŒ²":
    st.header("æ–°è¦èˆ¹èˆ¶ç™»éŒ²")
    
    with st.form("ship_registration"):
        col1, col2 = st.columns(2)
        
        with col1:
            ship_id = st.text_input("èˆ¹èˆ¶ID", placeholder="ä¾‹: SHIP001")
            name = st.text_input("èˆ¹èˆ¶å", placeholder="ä¾‹: Ocean Star")
            capacity = st.number_input("å®¹é‡ (TEU)", min_value=1, value=1000)
        
        with col2:
            speed = st.number_input("é€Ÿåº¦ (knots)", min_value=1.0, value=18.0)
            fuel_consumption = st.number_input("ç‡ƒæ–™æ¶ˆè²»é‡ (L/hour)", min_value=1.0, value=150
