import streamlit as st
import pandas as pd
from datetime import datetime
from src.berth_simulator import Ship

st.set_page_config(page_title="èˆ¹èˆ¶ç®¡ç†", page_icon="ğŸš¢")

st.title("ğŸš¢ èˆ¹èˆ¶ç®¡ç†")

# æ–°è¦èˆ¹èˆ¶ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ 
with st.expander("â• æ–°è¦èˆ¹èˆ¶ç™»éŒ²", expanded=False):
    with st.form("ship_form"):
        col1, col2 = st.columns(2)
        
        with col1:
            ship_id = st.text_input("èˆ¹èˆ¶ID")
            ship_name = st.text_input("èˆ¹å")
            length = st.number_input("èˆ¹é•·(m)", min_value=0.0, value=200.0)
            width = st.number_input("èˆ¹å¹…(m)", min_value=0.0, value=30.0)
        
        with col2:
            draft = st.number_input("å–«æ°´(m)", min_value=0.0, value=10.0)
            cargo_type = st.selectbox("è²¨ç‰©ç¨®åˆ¥", ["container", "bulk", "general", "tanker"])
            priority = st.slider("å„ªå…ˆåº¦", 1, 5, 3)
            eta = st.datetime_input("åˆ°ç€äºˆå®šæ™‚åˆ»", datetime.now())
        
        lat = st.number_input("ç¾åœ¨ä½ç½®(ç·¯åº¦)", value=35.0)
        lon = st.number_input("ç¾åœ¨ä½ç½®(çµŒåº¦)", value=140.0)
        
        if st.form_submit_button("èˆ¹èˆ¶ç™»éŒ²"):
            if ship_id and ship_name:
                new_ship = Ship(
                    ship_id, ship_name, length, width, draft, cargo_type,
                    (lat, lon), eta, priority
                )
                
                if 'ships' not in st.session_state:
                    st.session_state.ships = []
                
                st.session_state.ships.append(new_ship)
                st.success(f"èˆ¹èˆ¶ {ship_name} ã‚’ç™»éŒ²ã—ã¾ã—ãŸ!")
            else:
                st.error("èˆ¹èˆ¶IDã¨èˆ¹åã¯å¿…é ˆã§ã™ã€‚")

# ç™»éŒ²æ¸ˆã¿èˆ¹èˆ¶ä¸€è¦§
if 'ships' in st.session_state and st.session_state.ships:
    st.subheader("ç™»éŒ²æ¸ˆã¿èˆ¹èˆ¶")
    for i, ship in enumerate(st.session_state.ships):
        with st.expander(f"{ship.name} ({ship.id})"):
            col1, col2, col3 = st.columns(3)
            
            with col1:
                st.write(f"**èˆ¹é•·:** {ship.length}m")
                st.write(f"**èˆ¹å¹…:** {ship.width}m")
                st.write(f"**å–«æ°´:** {ship.draft}m")
            
            with col2:
                st.write(f"**è²¨ç‰©ç¨®åˆ¥:** {ship.cargo_type}")
                st.write(f"**å„ªå…ˆåº¦:** {ship.priority}")
                st.write(f"**ETA:** {ship.eta}")
            
            with col3:
                st.write(f"**ç¾åœ¨ä½ç½®:** {ship.current_position}")
                
                if st.button(f"å‰Šé™¤", key=f"delete_{i}"):
                    st.session_state.ships.pop(i)
                    st.rerun()
